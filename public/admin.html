
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mappool Admin</title>
  <style>
    body { font-family: Arial; padding: 2rem; background: #1b1b1b; color: white; }
    input, select { padding: 5px; margin: 5px; }
    textarea { width: 100%; height: 300px; margin-top: 1rem; }
    button { margin-top: 1rem; padding: 10px 15px; }
    label { display: inline-block; width: 100px; }
  </style>
</head>
<body>
  <h1>Mappool Admin Panel</h1>
  <div>
    <label>Beatmap URL:</label>
    <input type="text" id="urlInput" placeholder="https://osu.ppy.sh/beatmapsets/..."><br>
    <label>Slot:</label>
    <input type="text" id="slotInput" placeholder="NM1"><br>
    <label>Mod:</label>
    <input type="text" id="modInput" placeholder="NoMod"><br>
    <label>Skill:</label>
    <input type="text" id="skillInput" placeholder="Speed"><br>
    <button onclick="fetchInfo()">Fetch Info</button>
    <button onclick="addToPool()">Add to Pool</button>
    <button onclick="download()">Download JSON</button>
  </div>

  <h2>Current Beatmaps</h2>
  <pre id="mapList"></pre>

  <textarea id="jsonOutput" readonly></textarea>

  <script>
    let beatmaps = [];

    function fetchInfo() {
      const url = document.getElementById('urlInput').value;
      const match = url.match(/\/beatmapsets\/(\d+)#osu\/(\d+)/);
      if (!match) return alert("Invalid URL format.");
      const beatmapId = match[2];
      fetch("https://osu-api-proxy.onrender.com/api/beatmap/" + beatmapId)
        .then(res => res.json())
        .then(bm => {
          if (!bm.title) return alert("Couldn't fetch beatmap info.");
          document.getElementById('jsonOutput').value = JSON.stringify(bm, null, 2);
        })
        .catch(() => alert("Error fetching from server."));
    }

    function addToPool() {
      const bm = JSON.parse(document.getElementById('jsonOutput').value);
      if (!bm || !bm.title) return alert("No beatmap loaded.");

      const map = {
        slot: document.getElementById('slotInput').value,
        mod: document.getElementById('modInput').value,
        skill: document.getElementById('skillInput').value,
        title: bm.title,
        url: bm.url,
        stars: bm.stars,
        cs: bm.cs,
        ar: bm.ar,
        od: bm.od,
        bpm: bm.bpm,
        preview_url: bm.preview_url || "",
        cover_url: bm.cover_url || ""
      };
      beatmaps.push(map);
      updateList();
    }

    function updateList() {
      document.getElementById('mapList').textContent = beatmaps.map(m => m.slot + ": " + m.title).join("\n");
      document.getElementById('jsonOutput').value = JSON.stringify(beatmaps, null, 2);
    }

    function download() {
      const blob = new Blob([JSON.stringify(beatmaps, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'beatmaps.json';
      a.click();
    }
  </script>
</body>
</html>
